<div class="container-fluid sticky-top">
   <div class="shadow-sm bg-white rounded p-2">
      <div class="row">
         <div class="col-6  ">
            <button type="button" (click)="back()" class="btn border"><i class="bi bi-arrow-left"></i>
               BACK</button>
         </div>
         <div class="col-6 text-end">
            <a class="btn   border"
               (click)="showApplyDiscount==false ? showApplyDiscount = true : showApplyDiscount = false">
               {{showApplyDiscount==false ? 'Show' : 'Hide' }} Apply Discount </a>
         </div>
      </div>

   </div>
</div>

<div class="container-fluid mt-2">
   <div class="row g-0">
      <div class="col-4">
         <div class=" bg-light p-3 shadow-sm border rounded" #myDiv>
            <app-bill-table [data]="data" [showApplyDiscount]="showApplyDiscount">Loading...</app-bill-table>
         </div>
      </div>

      <div class="col-6 ">
         <div class="wrapper px-2 ">

            <div class="border bg-white p-1 rounded shadow-sm">
               <table class="table table-sm">
                  <thead>
                     <tr>
                        <th>Payment</th>
                        <th class="text-end">Amount</th>
                        <th class="text-end">Tips</th>
                        <th class="text-center">Paid</th>
                        <th class="text-center"><i class="bi bi-trash3-fill"></i></th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr *ngFor="let x of paid; let i = index" [class]="(i==paymentIndex)? 'td-active':''">
                        <td width="200">
                           <div class="form-control border-0">
                              {{x.name}}
                           </div>
                        </td>
                        <td>
                           <input type="text" class="form-control c1" currencyMask [(ngModel)]="x.paid"
                              [disabled]="x.submit==1" (blur)="updateRow(x)" (click)="paymentActive(i,'paid')"
                              [currencyMask]="{ prefix: '', thousands: ',',  min: 0, precision  : 0, allowNegative  :  false}">
                        </td>
                        <td>
                           <input type="text" class="form-control c1" currencyMask [(ngModel)]="x.tips"
                              [disabled]="x.submit==1" (blur)="updateRow(x)" (click)="paymentActive(i, 'tips')"
                              [currencyMask]="{ prefix: '', thousands: ',',  min: 0, precision  : 0, allowNegative  :  false}">
                        </td>
                        <td>
                           @if(x.submit == 1){
                           <h4 class="text-center"><i class="bi bi-check-lg"></i></h4>
                           }
                        </td>
                        <td>
                           <button type="button" class="btn text-danger" (click)="deletePaid(x)">
                              <i class="bi bi-trash3-fill"></i>
                           </button>
                        </td>
                     </tr>
                  </tbody>

               </table>
            </div>


            <div class="d-grid sticky-bottom mt-3 bg-white p-3">
               <div class="row g-3">
                  <div class="col-6">
                     <app-key-number (dataEmitted)="handleData($event)"></app-key-number>
                  </div>
                  <div class="col-6">
                     <div class="d-grid mb-2">
                        <button class="btn btn-warning btn-lg py-4 rounded shadow-sm"
                           (click)="clearCurrentValue()">CE</button>
                     </div>
                     <div class="d-grid">
                        <button class="btn btn-success btn-lg py-4 rounded shadow-sm"
                           (click)="addPaid()">SUBMIT</button>
                     </div>
                  </div>
               </div>


            </div>

         </div>
      </div>
      <div class="col-2 ">
         <div class="my-2 text-center">
            <strong>SELECT PAYMENT GROUP</strong>
         </div>
         <div *ngFor="let x of paymentGroups" class="d-grid">
            <button type="button" (click)="open(modalPayment, x)" class="py-3 btn btn-lg bg-warning mb-1">{{x.name |
               uppercase}}</button>
         </div>

      </div>
   </div>
</div>


<ng-template #modalPayment let-modal>
   <div class="modal-header">
      <strong class="modal-title">SELECT {{paymentGroup.name | uppercase}}</strong>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
   </div>
   <div class="modal-body">
      <div class="row g-2">

         <div class="col-3 d-grid" *ngFor="let x of paymentypes">
            <button type="button" (click)="addPayment(x)" class="py-3 btn  btn-light border mb-1">{{x.name | uppercase}}</button>


         </div>
      </div>
   </div>

</ng-template>

<ng-template #myModal let-modal>
   <div class="modal-header">
      <strong class="modal-title">Close Payment</strong>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
   </div>
   <div class="modal-body">
      <div class="row">

         <div class="col-12 text-center">
            <h4>Payment Finish</h4>
            <h4> CHANGE : {{data['change'] | number}} </h4>
         </div>
      </div>
   </div>
   <div class="p-3">
      <div class="d-grid mb-3">
         <button type="button" class="btn btn-lg btn-outline-dark py-3" (click)="modal.close('OK click')"><i
               class="bi bi-check2"></i> Finish</button>
      </div>

      <div class="d-grid">
         <button type="button" class="btn btn-lg btn-success py-3" (click)="modal.close('OK click')"><i
               class="bi bi-printer"></i> Finish And Print Closed Bill</button>
      </div>

   </div>
</ng-template>