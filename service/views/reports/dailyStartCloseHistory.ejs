<%- include('./global/header') %>

<%
    const payload = (report && report.data) || {};
    const rows = Array.isArray(payload.data) ? payload.data : [];
    const distinctBizDates = new Set();

    rows.forEach(row => {
        const candidate = row.startDate || row.closeDate || row.inputDate;
        if (!candidate) {
            return;
        }
        const dt = new Date(candidate);
        if (!Number.isNaN(dt.getTime())) {
            distinctBizDates.add(dt.toISOString().slice(0, 10));
        }
    });

    const totalRows = rows.length;
    const totalDistinctDays = distinctBizDates.size;
%>

<% if (rows.length) { %>
    <table class="table table-sm">
    <thead>
        <tr>
        <th >No</th>
        <th >Biz Date (Cnt)</th>
        <th>Beg Ck# /Next Ck#</th>
        <th >Start Date</th>
            <th >Start Employee</th>
        <th >Close Datetime</th>
        <th >Close Employee</th> 
        </tr>
    </thead>
    <tbody>
        <% rows.forEach(function(row, idx) { %>
        <tr>
            <td><%= idx + 1 %></td>
                <td><%= formatDateOnly(row.startDate || row.inputDate) %></td>
                    <td><%= row.id %></td>
                    <td><%= formatDate(row.startDate) %></td>
                    <td><%= row.startBy || '-' %></td>
            
                    <td><%= formatDate(row.closeDate) %></td>  
                    <td><%= row.endby || '-' %></td>  
            
        </tr>
        <% }); %>
    </tbody>

    </table>  
    <div>
    << Grand Total >><br>
        Total # Day Start/Day End:<%= totalRows %><br>
        Total # Distinct Day:<%= totalDistinctDays %><br>
    </div>
<% } else { %>
  <p>Tidak ada data untuk ditampilkan.</p>
<% } %>

<%- include('./global/footer') %>
