<%- include('./global/header') %>

<%
  var reportData = report || {};
  var payload = reportData.data || {};
  var rows = Array.isArray(payload.data) ? payload.data : [];
  var globalSummary = payload.globalSummary || {};

  var formatNumber = function(value) {
    return Number(value || 0).toLocaleString('id-ID');
  };
%>

<% if (rows.length) { %>
  <section style="margin-bottom:16px;">
    <table class="table table-sm" style="max-width:520px;">
      <tbody>
        <tr><td>Total Employees</td><td class="right"><%= formatNumber(globalSummary.totalDepartments) %></td></tr>
        <tr><td>Total Qty</td><td class="right"><%= formatNumber(globalSummary.globalQty) %></td></tr>
        <tr><td>Total Item Sales</td><td class="right"><%= formatNumber(globalSummary.globalItemSales) %></td></tr>
      </tbody>
    </table>
  </section>

  <% rows.forEach(function(entry, idx) { %>
    <section style="margin-top:20px;">
      <h2 style="margin-bottom:6px;">(<%= idx + 1 %>) <%= (entry.employee && entry.employee.name) || 'Unknown' %></h2>

      <% if (entry.items && entry.items.length) { %>
        <table class="table table-sm">
          <thead>
            <tr>
              <th style="width:40px;">No</th>
              <th>Nama Item</th>
              <th style="width:120px;">PLU</th>
              <th class="right" style="width:100px;">Qty</th>
              <th class="right" style="width:140px;">Item Sales</th>
              <th class="right" style="width:80px;">MenuSet</th>
            </tr>
          </thead>
          <tbody>
            <% entry.items.forEach(function(item, itemIdx) { %>
              <tr>
                <td><%= itemIdx + 1 %></td>
                <td><%= item.name %></td>
                <td><%= item.plu %></td>
                <td class="right"><%= formatNumber(item.qty) %></td>
                <td class="right"><%= formatNumber(item.itemSales) %></td>
                <td class="right"><%= Number(item.unserMenuSet) ? 'Yes' : '-' %></td>
              </tr>
            <% }); %>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3"><strong>Summary</strong></td>
              <td class="right"><strong><%= formatNumber(entry.summary && entry.summary.totalQty) %></strong></td>
              <td class="right"><strong><%= formatNumber(entry.summary && entry.summary.totalItemSales) %></strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      <% } else { %>
        <p>Tidak ada item untuk karyawan ini.</p>
      <% } %>
    </section>
  <% }); %>

  <section style="margin-top:20px;">
    <h3>Global Summary</h3>
    <table class="table table-sm" style="max-width:520px;">
      <tbody>
        <tr><td>Total Employees</td><td class="right"><%= formatNumber(globalSummary.totalDepartments) %></td></tr>
        <tr><td>Total Qty</td><td class="right"><%= formatNumber(globalSummary.globalQty) %></td></tr>
        <tr><td>Total Item Sales</td><td class="right"><%= formatNumber(globalSummary.globalItemSales) %></td></tr>
      </tbody>
    </table>
  </section>
<% } else { %>
  <p>Tidak ada data untuk ditampilkan.</p>
<% } %>

<%- include('./global/footer') %>
